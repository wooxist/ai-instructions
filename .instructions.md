# AI 에이전트 통합 지침 (Instructions Hub)

본 프로젝트의 모든 에이전트는 아래 문서를 기준으로 작업하십시오.

---

## 🎯 세션 관리 시스템 (CRITICAL - 최우선)

> **중요**: 모든 AI는 대화 시작 시 반드시 이 섹션을 먼저 읽고 세션을 관리해야 합니다.

### 개념: 세션 vs TODO

**세션 = 일기**
- 시간 축: 오늘, 어제, 지난주
- 내용: 오늘 뭐 했는지, 무슨 생각했는지, 어떤 결정 내렸는지
- 흐름: 자연스러운 대화, 생각의 과정
- 예시: "오늘 7장이랑 10장 비교해봤는데 차이가 너무 크더라"

**TODO = 업무**
- 작업 축: Phase 2.1-A, Phase 2.2, ...
- 내용: 뭘 해야 하는지, 어디까지 했는지, 다음은 뭔지
- 구조: 체크리스트, 우선순위, 의존성
- 예시: `- [ ] 7-10장 갭 분석 문서 작성`

### 파일 구조

```
.session/
  ├── 2025-10-06.md     # 오늘 세션
  ├── 2025-10-05.md     # 어제 세션
  ├── 2025-10-04.md     # 그저께 세션
  └── active.md         # 현재 활성 세션 (심볼릭 링크 또는 최신 세션)
```

### 세션 파일 포맷

```markdown
# 세션 YYYY-MM-DD

**시작**: HH:MM
**종료**: HH:MM (또는 "진행 중")
**타입**: 책 집필 / 기획 / 리뷰 등

---

## 관련 TODO
- Phase 2.1-A (갭 분석)
- Phase 2.2 (통합 예제 설계)

---

## 이 세션에서 한 것
- [x] 7장 읽고 분석 (14:30 완료)
- [x] 10장 읽고 분석 (15:00 완료)
- [ ] 갭 매트릭스 작성 중... (15:30 저장)

## 다음 세션에서 할 것
1. 갭 매트릭스 완성
2. gap-7-10.md 작성
3. TODO 체크박스 업데이트

---

## 관련 파일
- book/07-workflow.md
- book/10-collaboration.md
- .cache/todo/TODO.md

## 중요 메모/결정사항
- 7장: 단일 에이전트, 단순 파일 구조
- 10장: 복수 에이전트, 계층 구조 → 갭 너무 큼
- 결정: 7.5장 추가 방향으로 진행
```

---

## 🔄 세션 관리 룰

### Rule 1: 세션 시작 감지 (자동)

다음 패턴이 감지되면 **자동으로 세션을 시작**합니다:

**명시적 패턴**:
- "세션 시작", "시작", "start"
- "이어서", "계속", "continue"
- "/session", "/start"

**암묵적 패턴**:
- "오늘 할 일", "TODO 확인"
- "Phase X 시작", "작업 시작"
- 작업 지시가 포함된 첫 메시지

### Rule 2: 세션 시작 프로세스

1. **이전 세션 읽기**
   ```
   .session/active.md 또는 최신 날짜 파일 읽기
   "어제는 XXX를 했었네요" 맥락 파악
   ```

2. **오늘 세션 파일 생성**
   ```
   .session/YYYY-MM-DD.md 생성
   시작 시각 기록
   ```

3. **컨텍스트 연결**
   ```
   이전 세션의 "다음 세션에서 할 것" → 오늘 세션 "할 것"
   관련 TODO 자동 인식 및 링크
   ```

4. **사용자에게 확인**
   ```
   "어제 Phase 2.1-A 작업했었네요. 오늘은 갭 매트릭스 완성부터 하시겠어요?"
   ```

### Rule 3: 세션 업데이트 타이밍 (3-레벨)

**레벨 1: 자동 저장 (백그라운드)**
다음 순간에 즉시 `.session/YYYY-MM-DD.md` 업데이트:
- ✅ 체크박스 완료: `[ ]` → `[x]` 변경 시
- 📄 중요 파일 생성: 새 문서/코드 파일 생성 시
- ⏰ 10분 경과: 마지막 저장 후 10분 지났고 새 작업이 있을 때

**레벨 2: 명시적 저장**
사용자가 요청 시 즉시 저장:
- "저장", "save", "체크포인트"
- "기록해줘", "메모해줘"

**레벨 3: 세션 종료**
세션 종료 시 최종 정리:
- "오늘은 여기까지", "종료", "끝"
- "/session end", "/end"
- 종료 시각 기록
- "다음 세션에서 할 것" 정리

### Rule 4: TODO 연동

**자동 연동**:
세션에서 TODO 항목을 진행하면:
1. 세션 파일 "관련 TODO" 섹션에 자동 추가
2. TODO 완료 시 체크박스 자동 업데이트 제안
   - "Phase 2.1-A 완료했네요. TODO에도 체크할까요?"

**양방향 참조**:
- 세션 → TODO: "관련 TODO" 필드
- TODO → 세션: 선택적 (진행 세션 기록)

**컨텍스트 저장 위치**:
- 세션 파일이 컨텍스트의 주인
- TODO는 단순 체크리스트만 유지
- 상세한 진행 사항/결정/메모는 모두 세션에

---

## 📋 작업 프로세스 (CRITICAL)

### 1. 작업 시작 전 필수 확인 사항

**모든 AI 에이전트는 작업 시작 전에 반드시 다음을 확인합니다:**

1. **세션 파일 확인** (최우선)
   - `.session/active.md` 또는 최신 세션 읽기
   - 이전 작업 컨텍스트 파악
   - 오늘 세션 시작

2. **작업 문서 확인**
   - [ROADMAP.md](ROADMAP.md) - 전체 로드맵
   - [.cache/todo/TODO.md](.cache/todo/TODO.md) - 현재 작업
   - [.cache/todo/current-phase.md](.cache/todo/current-phase.md) - Phase 상세

3. **본 지침 확인**
   - .instructions.md (본 파일)

### 2. 작업 수행 프로세스

#### A. 새 작업 시작
```
1. 세션 파일에 작업 시작 기록
2. TODO.md에서 작업 선택
3. templates/task-template.md를 복사하여 context/{task-name}.md 생성
4. 작업 컨텍스트 기록 (목표, 배경, 세부 작업)
5. status.json 업데이트 (상태를 "in_progress"로)
6. 작업 수행
```

#### B. 작업 진행 중
```
1. 세션 파일에 진행 상황 실시간 업데이트 (레벨 1 자동 저장)
2. context/{task-name}.md에 상세 기록
3. 차단 사항 발생 시 즉시 문서화
4. 필요시 TODO.md 우선순위 조정
```

#### C. 작업 완료
```
1. 세션 파일 체크박스 완료 처리
2. 산출물을 지정된 경로에 저장
3. TODO.md "완료된 작업" 섹션에 기록
4. ROADMAP.md 해당 항목 체크
5. changelog.md에 변경 내역 기록
6. status.json 업데이트
```

### 3. 문서 동기화 규칙 (SSOT 유지)

**변경 사항이 발생하면 관련된 모든 문서를 동기화해야 합니다:**

| 변경 유형 | 업데이트 필요 문서 |
|---------|------------------|
| 세션 작업 완료 | TODO.md, status.json, 해당 세션 파일 |
| book/ 콘텐츠 추가/수정 | ROADMAP.md, TODO.md, changelog.md, book/index.md, 세션 파일 |
| 프로젝트 구조 변경 | ROADMAP.md, README.md, .instructions.md, 세션 파일 |
| Phase 완료 | ROADMAP.md, current-phase.md, status.json, 세션 파일 |
| 작업 상태 변경 | TODO.md, status.json, changelog.md, 세션 파일 |

---

## 📂 문서 계층 구조

```
프로젝트 루트/
├── .session/                     # 세션 관리 (일기)
│   ├── 2025-10-06.md
│   ├── 2025-10-05.md
│   └── active.md
├── ROADMAP.md                    # 마스터 로드맵 (중장기 비전)
├── README.md                     # 프로젝트 개요
├── .instructions.md              # 본 파일 (AI 협업 가이드)
├── .cache/todo/
│   ├── TODO.md                   # 단기 작업 목록 (1-2주)
│   ├── current-phase.md          # 현재 Phase 상세
│   ├── changelog.md              # 변경 이력
│   ├── status.json               # 작업 상태 추적
│   ├── analysis/                 # 분석 자료
│   ├── planning/                 # 계획 자료
│   ├── context/                  # 작업 컨텍스트
│   └── templates/                # 템플릿
└── book/
    ├── ROADMAP.md                # root ROADMAP 리다이렉트
    ├── index.md                  # 전체 목차
    ├── glossary.md               # 용어집
    ├── practice-guide.md         # 실습 가이드
    └── *.md                      # 각 장 콘텐츠
```

---

## 🔄 점진적 캐싱 방식

### 개념
작업을 진행하면서 점진적으로 컨텍스트를 축적하고, 이를 파일로 캐싱하여 AI가 작업을 재개할 때 빠르게 상황을 파악할 수 있도록 합니다.

### 구현 방법

#### 1. 세션 컨텍스트 캐싱 (최우선)
- `.session/YYYY-MM-DD.md` 파일에 모든 작업 기록
- 대화 내용, 결정사항, 진행 상황 실시간 저장
- 다음 세션에서 이 파일을 읽고 즉시 작업 재개

#### 2. 작업 컨텍스트 캐싱
- 각 작업마다 `context/{task-name}.md` 파일 생성
- 작업 목표, 진행 상황, 결정 사항, 차단 사항 기록
- 장기 작업의 경우 세션을 넘어서 관리

#### 3. 상태 추적
- `status.json`에 작업 상태를 JSON으로 기록
- 자동화 스크립트가 이 파일을 읽어 대시보드 생성 가능

#### 4. 변경 이력
- `changelog.md`에 모든 변경 사항을 시간순으로 기록
- 누가, 언제, 무엇을, 왜 변경했는지 추적

---

## 📖 가이드북 집필 가이드 (WRITER GUIDE)

> 이 섹션은 book/ 디렉토리의 집필 규칙 SSOT입니다. 
> 원본: book/WRITER.md (삭제 예정) → .instructions.md로 통합

### 1. 톤앤매너 (Tone & Manner)

이 책은 **실용적인 '일잘법' 가이드북**입니다. 미래 예측서나 심오한 학술 논문이 아님을 명심해야 합니다.

**핵심 원칙:**
- **관점**: 거창한 미래 비전이 아닌, 독자가 겪는 현실적인 문제 해결에 집중
- **핵심 비유**: AI를 '믿을 수 있는 부사수' 또는 '든든한 업무 동료'로 묘사
- **가치 제안**: 복잡한 LLM 튜닝 없이, '잘 설계된 인스트럭션'만으로 업무 효율 극대화
- **용어 사용**: 전문 용어는 항상 직관적인 비유와 함께 설명
- **표현 지양**: 과장되거나 미래지향적인 표현 (예: '미래를 지배한다', '궁극의 지능')

### 2. 구조와 파트 구성

- **파트는 5개로 유지**:
  - Part 1: 1–3장 (기초)
  - Part 2: 4–6장 (설계 원칙·구성 요소)
  - Part 3: 7–9장 (워크플로우·성능·평가)
  - Part 4: 10–11장 (아키텍처·설계 패턴)
  - Part 5: 12–15장 (확장·운영)
- 각 장 상단의 Part 라벨과 `book/index.md` 목차의 파트 섹션을 동기화합니다.

### 3. 목차와 교차 링크

- `book/index.md`는 "상세 목차(서브챕터 포함)"를 유지합니다. 서브챕터 목록은 삭제하지 않습니다.
- 내부 링크는 실제 존재하는 파일·섹션으로만 연결합니다.
- 장·파일명이 변경되면 교차 링크를 즉시 갱신합니다.
- 11장 사례 맵은 `11-1-single-agent.md` 상단에 유지하고, `index.md`에서 해당 섹션으로 앵커 링크를 제공합니다.

### 4. 체크리스트와 실습

- 각 장 말미에 "실습 체크리스트" 섹션을 포함합니다.
  - 형식: "이 장을 완료하셨다면…" + "실습 과제" 1–2개
  - 표준 포맷: 1장 형식(개념 이해/실습 능력/적용 및 활용)을 따릅니다.
- 부록 `book/practice-guide.md`에 장별 심화 과제를 유지합니다.

### 5. SSOT 동기화

book/ 업데이트 시 다음을 반드시 점검합니다:
- `book/index.md` (목차)
- `README.md` (파트 구조 또는 프로젝트 구조 변경 시)
- `ai-knowledge/meta-agent-design/book-summary.md` (요약 - 외부 지식베이스)

---

## 🎨 시각 자료 스타일 가이드 (Mermaid SSOT)

> 이 섹션은 가이드북 전반의 Mermaid 다이어그램 스타일 SSOT입니다.
> 원본: book/WRITER.md 부록 A + book/visual-style-guide.md (모두 삭제 예정)

### 기본 테마 초기화 스니펫

모든 다이어그램 상단에 아래 스니펫을 붙여 일관된 색상·선 스타일을 적용합니다.

```mermaid
%%{init: {
  'theme': 'base',
  'themeVariables': {
    'primaryColor': '#1f77b4',
    'primaryTextColor': '#ffffff',
    'primaryBorderColor': '#1f77b4',
    'lineColor': '#6c757d',
    'noteBkgColor': '#f8f9fa',
    'noteTextColor': '#212529',
    'background': 'transparent',
    'edgeLabelBackground': '#2ca02c'
  }
}}%%
```

### 도형과 의미 매핑

- **개념/원칙**: 직사각형 `id[Text]`
- **결정(분기)**: 마름모 `id{Question}`
- **에이전트(역할)**: 둥근 사각형 `id(Text)`
- **산출물/문서**: 서브루틴 `id[[Artifact]]`
- **데이터/저장소/로그**: 실린더 `id[(Data)]`
- **사람(Human-in-the-Loop)**: 원형 `id((Human))`

### 공통 클래스 정의 (선택)

필요 시 아래 클래스를 다이어그램에 포함해 시맨틱 강조를 통일합니다.

```mermaid
%% 클래스 예시 (다이어그램 내부에 포함)
classDef principle fill:#1f77b4,stroke:#1f77b4,color:#ffffff;
classDef decision fill:#ffffff,stroke:#495057,stroke-width:2px,color:#212529;
classDef agent fill:#6f42c1,stroke:#6f42c1,color:#ffffff;
classDef artifact fill:#17a2b8,stroke:#17a2b8,color:#ffffff;
classDef data fill:#2ca02c,stroke:#2ca02c,color:#ffffff;
classDef human fill:#e83e8c,stroke:#e83e8c,color:#ffffff;
```

### 레이아웃 규칙

- **흐름 방향**: 기본 `LR`(좌→우), 복잡한 경우 `TD` 사용
- **서브그래프**: 팀/조직/모듈 경계를 표현할 때 사용 (제목은 역할 기준)
- **라벨**: 동사+목적어 5–7단어 이내, 핵심만 기입
- **간선**: 의미 있는 곳에만 라벨 (예/아니오, 승인/반려 등)

### 작성 팁

- **한 다이어그램 = 한 메시지**: 각 다이어그램은 1가지 핵심 메시지에 집중
- **산출물 명시**: 산출물을 명시하고 (파일·JSON 등), 다음 단계 입력과 연결
- **검증 게이트 강조**: 검증/승인 게이트는 `human_in_the_loop` 노드로 강조

---

## 🎯 작업 우선순위 원칙

### 1. 세션 관리 우선
- 모든 작업은 세션 파일에 기록
- 채팅창을 나가도 언제든 재개 가능하도록
- 컨텍스트 손실 방지

### 2. 독자 경험 우선
- 학습 곡선 완화가 최우선
- 실습 연계성 강화
- 통합 예제 제공

### 3. SSOT 유지
- 정보 중복 최소화
- 단일 진실 공급원 유지
- 문서 간 일관성 보장

### 4. 점진적 개선
- 완벽보다는 빠른 피드백
- 반복적 개선
- 독자 피드백 기반 조정

---

## 🚨 주의사항

### 절대 하지 말아야 할 것

1. **세션 관리 누락**
   - 세션 파일 읽지 않고 작업 시작
   - 진행 상황 미기록
   - 다음 세션을 위한 메모 누락

2. **ROADMAP과 TODO 중복**
   - ROADMAP: 중장기 계획만
   - TODO: 단기 실행 가능한 작업만

3. **문서 동기화 누락**
   - 하나의 문서만 업데이트하고 관련 문서 미업데이트

4. **컨텍스트 누락**
   - 작업 시작 시 context 파일 생성 안 함
   - 진행 상황 미기록

5. **톤앤매너 위반**
   - 과장된 표현 사용
   - 학술적이거나 추상적인 설명

6. **다이어그램 스타일 불일치**
   - 초기화 스니펫 누락
   - 도형 의미 매핑 무시
   - "한 다이어그램 = 한 메시지" 원칙 위반

---

## 🔧 도구 및 자동화

### 권장 도구
- **Markdown 편집**: VS Code + Markdown Preview
- **다이어그램**: Mermaid (가이드북), Excalidraw (기획)
- **버전 관리**: Git

### 자동화 가능한 작업
- `status.json` → 대시보드 생성
- `TODO.md` → 주간 보고서 생성
- `changelog.md` → 릴리스 노트 생성

---

## 📚 참고 문서

### 필수 참조
- [.session/](/.session/) - 세션 관리 (일기)
- [ROADMAP.md](ROADMAP.md) - 프로젝트 전체 로드맵
- [README.md](README.md) - 프로젝트 개요
- [book/glossary.md](book/glossary.md) - 용어집
- [book/practice-guide.md](book/practice-guide.md) - 실습 가이드

---

## 📝 버전 이력

- **v2.0.0** (2025-10-06): 세션 관리 시스템 추가 (CRITICAL)
- **v1.1.0** (2025-10-06): 집필 가이드 및 시각 자료 스타일 통합 (WRITER.md, visual-style-guide.md 통합)
- **v1.0.0** (2025-10-06): 점진적 캐싱 구조 확립, 문서 계층 명확화
- **v0.1.0** (초기): 기본 집필 가이드
