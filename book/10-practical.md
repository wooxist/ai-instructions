# 8장. 상황별 인스트럭션 설계 패턴 예제

**Part 2: 복잡한 인스트럭션 설계**

**목적:** 4장에서 제시된 '규모와 복잡도 매트릭스'의 9가지 상황에 맞춰, 4~7장에서 배운 설계 원칙과 방법론을 적용한 구체적인 인스트럭션 예제를 학습합니다.

### 이 장에서 배우는 것
- 간단한 개인용 에이전트부터 복잡한 조직 표준 시스템까지, 상황에 맞는 인스트럭션 설계 패턴을 익힙니다.
- 각 상황에서 어떤 설계 원칙(메타 원칙, 에이전트, 입/출력, 워크플로우)이 중요하게 적용되는지 이해합니다.
- 이 장의 예제들을 템플릿으로 활용하여 자신의 문제에 맞는 인스트럭션을 설계할 수 있습니다.

---

## 들어가며: 상황에 맞는 옷 입기

모든 문제에 동일한 방식의 인스트럭션을 적용할 수는 없습니다. 간단한 이메일 요약과 법률 계약서 분석에 필요한 지시의 정교함은 완전히 다릅니다. 4장에서 제시된 매트릭스는 바로 이런 상황에 맞는 '설계의 깊이'를 결정하는 나침반 역할을 합니다.

이 장에서는 매트릭스의 9가지 각 칸에 해당하는 구체적인 예제를 통해, 이론이 실제 인스트럭션에서 어떻게 구현되는지 살펴봅니다. 각 예제는 독립적으로 참고할 수 있는 작은 패턴 라이브러리 역할을 할 것입니다.

| | **간단/일상**<br>(낮은 위험, 단순 반복) | **표준/전문**<br>(중간 복잡도, 전문 지식) | **복잡/중요**<br>(높은 위험, 법적/재정적 책임) |
| :--- | :--- | :--- | :--- |
| **단일 에이전트** | 8.1 이메일 요약 | 8.2 블로그 초고 작성 | 8.3 법률 조항 분석 |
| **다중 에이전트** | 8.4 콘텐츠 생성 파이프라인 | 8.5 코드 생성 및 리뷰 | 8.6 재무 데이터 분석 및 보고 |
| **조직 표준** | 8.7 회의록 요약 표준화 | 8.8 사내 Q&A 봇 | 8.9 고객 리뷰 분석 시스템 |

---

## 8.1 [사례 1] 단일 에이전트, 간단/일상

- **상황:** 매일 수신하는 이메일 뉴스레터를 빠르게 훑어보기 위해 3줄 요약이 필요하다.

#### 최종 인스트럭션 예시
```markdown
# 역할: 전문 요약 비서
당신은 바쁜 경영진을 위해 긴 글의 핵심만 정확히 뽑아내는 전문 비서입니다.

# 목표
주어진 이메일 본문을 3개의 불릿 포인트로 요약한다.

# 출력 규칙
- 요약은 반드시 3개의 불릿(-)으로 구성되어야 한다.
- 각 불릿은 완전한 한글 문장으로 끝나야 한다.
- 가장 중요한 결론이나 액션 아이템을 첫 번째 불릿에 위치시킨다.
```

#### 설계 분석
- **메타 원칙 (4장):** **산출물 중심** 원칙이 핵심적으로 적용됩니다. `#출력 규칙`에서 결과물의 형식, 구조, 순서까지 명확히 정의하여 AI가 무엇을 만들어야 할지 정확히 알게 합니다.
- **에이전트 설계 (5장):** '전문 요약 비서'라는 간단한 **역할**을 부여하여, 글의 목적에 맞는 요약 스타일을 유도합니다.
- **입/출력 설계 (6장):** 사용자가 제공하는 이메일 본문이 **입력**이며, `#출력 규칙`에 명시된 3개의 불릿이 명확한 **출력** 명세가 됩니다.
- **워크플로우 설계 (7장):** 단계가 하나인 단일 작업이므로, 별도의 워크플로우 설계는 필요하지 않습니다.

> **실용적인 팁:** 이처럼 간단하고 개인적인 인스트럭션은 별도의 파일 시스템보다, ChatGPT의 'Custom Instructions'나 다른 AI 애플리케이션의 '시스템 프롬프트' 설정에 저장해두고 필요할 때마다 간편하게 활용하는 것이 더 효율적일 수 있습니다.

---

## 8.2 [사례 2] 단일 에이전트, 표준/전문

- **상황:** 특정 기술 주제에 대한 전문적인 블로그 포스팅의 초고 작성이 필요하다.

#### 최종 인스트럭션 예시
```markdown
# 역할: 10년차 테크니컬 라이터

# 목표
'RAG(검색 증강 생성)' 기술에 대해 비전문가도 이해할 수 있는 블로그 포스트 초고를 작성한다.

# 컨텍스트
- 대상 독자: 개발 경험이 없는 기획자, 마케터
- 게시 플랫폼: 회사 기술 블로그
- 핵심 메시지: "RAG는 AI가 최신 정보를 학습하고, 할루시네이션 없이 답변하게 하는 중요한 기술이다."

# 처리 방법
1. 아래 제공된 `[참고 자료]` 섹션의 내용만을 기반으로 글을 작성한다.
2. 글의 구조는 서론, 본론(RAG의 원리, 장점), 결론 순서를 따른다.
3. 어려운 기술 용어는 반드시 쉬운 비유를 들어 설명한다.

# 출력 형식
- 마크다운 형식으로 작성한다.
- 전체 분량은 800자 내외로 한다.

# 참고 자료
- [Lewis, P., et al. (2020). Retrieval-Augmented Generation...]
- [회사 내부 RAG 기술 소개 자료 URL]
```

#### 설계 분석
- **메타 원칙 (4장):** **컨텍스트 명시성** 원칙에 따라 `#컨텍스트`에서 글의 목적과 독자를 명확히 하고, **SSOT** 원칙에 따라 `#참고 자료`로 정보 출처를 한정합니다. **산출물 중심** 원칙은 `#출력 형식`에서 결과물의 사양을 정의하는 데 사용됩니다.
- **에이전트 설계 (5장):** '10년차 테크니컬 라이터'라는 전문적인 **페르소나**를 부여하여 글의 품질과 스타일을 제어합니다.
- **입/출력 설계 (6장):** `#참고 자료`가 명시적인 **입력** 데이터가 되며, `#출력 형식`이 결과물의 구조와 분량을 정의하는 **출력** 명세가 됩니다.
- **워크플로우 설계 (7장):** `#처리 방법`에서 글을 작성하는 절차를 간단한 단계로 나누어 제시하고 있습니다.

---

## 8.3 [사례 3] 단일 에이전트, 복잡/중요

- **상황:** 외부 업체와 계약 전, 법률 계약서 초안에서 회사에 불리할 수 있는 독소 조항을 검토해야 한다.

#### 최종 인스트럭션 예시
```markdown
# 역할: 15년차 기업 법무팀 변호사 (검토 보조 역할)

# 목표
주어진 계약서 초안에서, '책임 및 보상', '계약 해지', '지적 재산권' 세 가지 영역에 대해 당사에 잠재적 위험이 될 수 있는 조항을 각 1개씩 식별하고, 분석 보고서를 생성한다.

# 처리 방법
1. 계약서 전체를 읽고, 위 3가지 영역으로 나누어 분석한다.
2. 각 영역에서 가장 위험도가 높다고 판단되는 조항을 1개씩 선정한다.
3. 3개의 조항에 대해, 아래 `[출력 형식]`에 맞춰 보고서를 생성한다.

# 제약 조건
- 이 보고서는 법률적 자문이 아니며, 실제 의사결정은 반드시 담당 변호사의 검토를 거쳐야 한다. 보고서 서두에 이 경고 문구를 반드시 포함하라.
- 조항의 해석이 모호할 경우, 자의적으로 판단하지 말고 "[해석 필요]" 태그를 달고 사용자에게 질문하라.

# 출력 형식 (JSON)
{
  "report_id": "[문서 ID]",
  "clauses": [
    {
      "category": "책임 및 보상",
      "clause_number": "[조항 번호]",
      "risk_description": "[위험성에 대한 상세 설명]",
      "recommendation": "[수정 또는 삭제 제안]"
    }
  ]
}
```

#### 설계 분석
- **메타 원칙 (4장):** **MECE** 원칙에 따라 분석 대상을 3가지 영역으로 명확히 나누고, **피드백 루프** 원칙을 통해 모호할 때 질문하도록 유도합니다. **Human-in-the-Loop**와 **윤리적 경계** 원칙은 AI의 역할을 '보조'로 한정하고 최종 책임을 사람에게 두어 리스크를 관리합니다.
- **에이전트 설계 (5장):** AI의 **역할**을 '보조'로 명확히 하고, 법률 판단을 직접 내리지 않도록 하는 중요한 **제약**을 설정합니다.
- **입/출력 설계 (6장):** 입력은 '계약서 초안'이며, 출력은 보고서의 구조를 명확히 정의한 `JSON` 형식으로, 기계적 처리가 용이한 **구조화된 출력**입니다.
- **워크플로우 설계 (7장):** `#처리 방법`이 간단한 순차적 태스크를 정의합니다.

---

## 8.4 [사례 4] 다중 에이전트, 간단/일상

- **상황:** 아이디어를 간단한 트윗(X) 포스트로 만드는 콘텐츠 생성 파이프라인.

#### 최종 인스트럭션 예시
```markdown
# 워크플로우: 아이디어 → 트윗 변환

1. **AGENT 1: 아이디어 확장 에이전트**
   - **입력:** 한 문장의 아이디어 (예: "AI를 활용한 생산성 팁")
   - **역할:** 창의적인 마케터
   - **태스크:** 입력된 아이디어를 바탕으로, 사람들의 흥미를 끌 만한 3가지 다른 각도의 접근법을 제안한다.
   - **출력:** 3가지 접근법 목록 (간단한 텍스트)

2. **AGENT 2: 트윗 작성 에이전트**
   - **입력:** 사용자가 선택한 1가지 접근법
   - **역할:** 소셜 미디어 전문가
   - **태스크:** 선택된 접근법을 140자 이내의 트윗 형식으로 다듬는다. 이모지를 1~2개 포함한다.
   - **출력:** 최종 트윗 문장
```

#### 설계 분석
- **메타 원칙 (4장):** **SoC(관심사 분리)** 원칙에 따라 아이디어 발상과 문장 다듬기 역할을 분리하고, **점진적 개선** 원칙을 통해 한 번에 완벽한 결과 대신 단계를 거쳐 결과물을 구체화합니다.
- **에이전트 설계 (5장):** 각 에이전트는 '창의적 마케터'와 '소셜 미디어 전문가'라는 명확하고 구분되는 **역할**을 가집니다.
- **입/출력 설계 (6장):** 1번 에이전트의 **출력**(3가지 접근법)이 2번 에이전트의 **입력**이 되는 명확한 데이터 흐름을 가집니다.
- **워크플로우 설계 (7장):** 가장 간단한 형태의 **파이프라인 패턴(A→B)**을 사용하여 두 에이전트를 순차적으로 연결합니다.

---

## 8.5 [사례 5] 다중 에이전트, 표준/전문

- **상황:** 사용자의 요구사항에 맞는 Python 코드를 생성하고, 자체적으로 리뷰까지 수행하는 워크플로우.

#### 최종 인스트럭션 예시
```markdown
# 워크플로우: 요구사항 기반 코드 생성 및 리뷰

1. **AGENT 1: Python 코드 생성 에이전트**
   - **입력:** "S3 버킷의 모든 이미지 파일에 대해 썸네일을 생성하는 함수를 만들어줘."
   - **역할:** 10년차 Python 개발자
   - **태스크:** 요구사항에 맞는 함수 코드를 생성한다. boto3 라이브러리를 사용한다.
   - **출력:** `generated_code.py`

2. **AGENT 2: 코드 리뷰 에이전트**
   - **입력:** `generated_code.py`
   - **역할:** 깐깐한 시니어 동료 개발자
   - **태스크:** 입력된 코드에 대해 다음 기준으로 리뷰를 수행한다.
     1. PEP 8 스타일 가이드 준수 여부
     2. 하드코딩된 값(API 키, 버킷 이름) 존재 여부
     3. 예외 처리(try-except) 누락 여부
   - **출력:** 리뷰 결과 (JSON 형식, '통과' 또는 '수정 필요' 상태와 수정 제안 목록 포함)

3. **[조건 분기]**
   - **IF** 리뷰 결과 == '수정 필요':
     - 리뷰 내용을 포함하여 **AGENT 1**을 다시 호출
   - **ELSE:**
     - **[END]**
```

#### 설계 분석
- **메타 원칙 (4장):** **SoC** 원칙에 따라 생성과 검토 역할을 분리하고, **피드백 루프**를 통해 결과물을 자동 개선합니다. 리뷰 태스크는 **원자성** 원칙에 따라 명확한 항목으로 나뉩니다.
- **에이전트 설계 (5장):** 각 에이전트는 '개발자'와 '리뷰어'라는 명확한 **역할**과 **페르소나**를 가지며, 이는 각자의 **책임**을 명확히 합니다.
- **입/출력 설계 (6장):** 2단계의 **출력**이 `JSON` 형식으로 구조화되어, 3단계의 **조건 분기**에서 기계적으로 처리(parsing)하기 용이합니다.
- **워크플로우 설계 (7장):** **'생성-검증' 패턴**과 **'분기 패턴'**이 결합된 워크플로우로, 피드백을 통해 스스로를 개선하는 자동화된 시스템을 구축합니다.

---

## 8.6 [사례 6] 다중 에이전트, 복잡/중요

- **상황:** 분기별 매출 데이터를 분석하고, 시각화 자료를 포함한 보고서 초안을 생성하며, 최종적으로 경영진에게 보낼 이메일까지 작성하는 복잡한 재무 보고 프로세스.

#### 최종 인스트럭션 예시 (개념적)
이 경우, 각 에이전트는 별도의 파일로 정의되고, 워크플로우 엔진에 의해 실행되는 복잡한 시스템이 됩니다. (8.9 사례와 유사)

- **AGENT 1: 데이터 추출 에이전트 (with Tool)**
- **AGENT 2: 데이터 분석 및 시각화 에이전트 (with Tool)**
- **AGENT 3: 보고서 작성 에이전트**
- **AGENT 4: 이메일 작성 에이전트**
- **최종 검토 (Human-in-the-Loop)**

#### 설계 분석
- **메타 원칙 (4장):** **SoC, MECE** 원칙에 따라 에이전트 역할이 명확히 분리되고, **SSOT** 원칙에 따라 단일 데이터 소스를 사용합니다. 각 단계는 **원자성**과 **산출물 중심** 원칙을 따르며, 최종적으로 **Human-in-the-Loop** 원칙으로 리스크를 관리합니다.
- **에이전트 설계 (5장):** 각 에이전트는 'DBA', '데이터 분석가', '재무 분석가' 등 고도의 전문화된 **역할**을 가지며, 외부 **도구(Tool)**를 사용할 수 있는 권한과 **제약**을 가집니다.
- **입/출력 설계 (6장):** 각 단계의 입/출력(SQL 쿼리, CSV, PNG 이미지, Markdown 보고서)이 명확히 정의되어, 전체 프로세스의 데이터 흐름을 구성합니다.
- **워크플로우 설계 (7장):** 여러 에이전트가 순차적으로 실행되는 **파이프라인 패턴**을 기반으로 하며, 최종 단계에 인간의 승인(Approval)이 포함된 복합 워크플로우입니다.

---

## 8.7 [사례 7] 조직 표준, 간단/일상

- **상황:** 조직 내 모든 팀에서 공통적으로 사용하는 회의록 요약 규칙.

#### 최종 인스트럭션 예시 (공유 템플릿)
조직의 위키(Confluence 등)나 공유 문서에 아래 템플릿을 저장하고, 모든 팀원이 회의록 요약 시 이 템플릿을 사용하도록 안내합니다.

```markdown
# 회의록 요약 표준 인스트럭션 (v1.2)

# 목표
주어진 회의록 텍스트를 지정된 형식에 맞춰 요약한다.

# 출력 형식
## 회의 핵심 결정사항 (3가지)
- [결정사항 1]
- [결정사항 2]
- [결정사항 3]

## Action Items (담당자, 기한 명시)
- [할 일 1] - 담당자: [이름], 기한: [YYYY-MM-DD]
- [할 일 2] - 담당자: [이름], 기한: [YYYY-MM-DD]
```

#### 설계 분석
- **메타 원칙 (4장):** **SSOT** 원칙이 가장 중요하게 작용합니다. 중앙의 단일 템플릿을 통해 모든 조직원이 동일한 품질과 형식의 결과물을 얻도록 보장합니다. **점진적 개선** 원칙에 따라, 템플릿은 버전(v1.2) 관리되며 지속적으로 발전할 수 있습니다.
- **에이전트 설계 (5장):** 특정 페르소나보다는, 조직의 표준을 따라야 하는 **책임**과 **제약**이 더 강조됩니다.
- **입/출력 설계 (6장):** **출력** 형식이 매우 엄격하게 정의되어 있어, 누가 실행하든 일관된 구조의 결과물을 보장합니다.
- **워크플로우 설계 (7장):** 단일 에이전트, 단일 태스크이므로 복잡한 워크플로우는 필요 없습니다.

---

## 8.8 [사례 8] 조직 표준, 표준/전문

- **상황:** 사내의 복잡한 규정이나 프로세스에 대해 직원들의 질문에 답변하는 Q&A 봇.

#### 최종 인스트럭션 예시 (시스템 프롬프트)
```markdown
# 역할: [우리 회사] 인사규정 전문 비서

# 처리 방법
1. 사용자의 질문을 분석한다.
2. 질문에 답하기 위해, `[내부 규정 문서]` 벡터 DB에서 가장 관련성이 높은 문서를 3개 검색한다.
3. 검색된 문서의 내용만으로 답변을 생성한다. 절대 추측하거나 기존 지식을 사용하지 않는다.
4. 답변의 마지막에는 반드시 참고한 문서의 제목과 페이지 번호를 출처로 명시한다.

# 제약 조건
- 만약 검색된 문서로 답변을 할 수 없다면, "죄송합니다. 해당 내용은 규정집에서 찾을 수 없습니다. 인사팀에 문의해주세요."라고만 답변한다.
- 연봉, 개인 평가 등 민감 정보와 관련된 질문에는 답변을 거부한다.

# 내부 규정 문서
- [내부 인사 규정 v3.4.pdf]
- [복리후생 가이드 v2.1.pdf]
```

#### 설계 분석
- **메타 원칙 (4장):** **SSOT** 원칙에 따라 답변의 근거가 되는 지식 소스를 중앙에서 관리되는 `내부 규정 문서`로 한정합니다. **피드백 루프** 원칙에 따라, 답변 불가 시 명확한 다음 행동(인사팀 문의)을 안내합니다.
- **에이전트 설계 (5장):** AI는 '인사규정 전문 비서'라는 **역할**을 수행하며, 추측 금지, 민감 정보 답변 거부 등 명확한 **윤리적/운영적 제약** 하에 작동합니다.
- **입/출력 설계 (6장):** 사용자의 자연어 질문이 **입력**이고, 근거가 명시된 답변이 **출력**입니다. RAG 기술을 활용하여 입력된 질문에 가장 적합한 컨텍스트를 동적으로 구성합니다.
- **워크플로우 설계 (7장):** '질문 분석 → 문서 검색 → 답변 생성'의 간단한 **파이프라인 패턴**을 따릅니다.

---

## 8.9 [사례 9] 조직 표준, 복잡/중요

- **상황:** 전사적으로 사용하는, 여러 부서(제품, 마케팅, CS)의 데이터가 통합되는 '주간 고객 리뷰 분석 시스템'.

#### 최종 인스트럭션 시스템 예시

이 단계의 인스트럭션은 더 이상 하나의 '글'이 아닌, 여러 부품이 유기적으로 연결된 하나의 '소프트웨어 시스템'과 같은 형태를 띠게 됩니다.

**1. 디렉토리 구조**
```
/instructions/weekly_review_report/
├── main.md              # 엔트리포인트
├── workflow.md          # 워크플로우 정의
├── agents/              # 에이전트 정의 폴더
│   ├── classifier.md
│   ├── extractor.md
│   └── summarizer.md
└── schemas/             # 데이터 스키마 폴더
    └── report.schema.json
```

**2. 설계 분석**

- **메타 원칙 (4장):** **SoC**에 따라 기능이 파일 단위로 분리되고, **SSOT**에 따라 `workflow.md`가 전체 구조를 정의합니다. 각 단계는 **원자적**이며, 최종 결과물은 **산출물 중심** 원칙에 따라 스키마로 관리됩니다. **Human-in-the-Loop**를 통한 최종 검증도 가능합니다.
- **에이전트 설계 (5장):** `agents/` 폴더 내에 각 에이전트의 **역할, 책임, 제약**이 개별 파일로 명확히 정의되어, 시스템의 모듈성과 유지보수성을 높입니다.
- **입/출력 설계 (6장):** `schemas/` 폴더에 위치한 `report.schema.json` 파일이 최종 결과물의 구조를 명세화하여, 시스템 전체의 **출력** 일관성을 보장합니다.
- **워크플로우 설계 (7장):** `workflow.md` 파일이 **파이프라인 패턴**에 따라 에이전트들의 협력 순서와 데이터 **핸드오프** 규칙, 그리고 각 단계의 **실패 처리** 방안을 명시적으로 정의합니다.
